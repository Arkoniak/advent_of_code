Second part is rather slow, one can think about optimization
